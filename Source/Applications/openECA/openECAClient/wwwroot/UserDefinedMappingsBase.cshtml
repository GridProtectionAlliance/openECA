@*******************************************************************************************************
//  UserDefinedTypes.cshtml - Gbtc
//
//  Copyright © 2016, Grid Protection Alliance.  All Rights Reserved.
//
//  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See
//  the NOTICE file distributed with this work for additional information regarding copyright ownership.
//  The GPA licenses this file to you under the MIT License (MIT), the "License"; you may not use this
//  file except in compliance with the License. You may obtain a copy of the License at:
//
//      http://opensource.org/licenses/MIT
//
//  Unless agreed to in writing, the subject software distributed under the License is distributed on an
//  "AS-IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the
//  License for the specific language governing permissions and limitations.
//
//  Code Modification History:
//  ----------------------------------------------------------------------------------------------------
//  01/15/2016 - J. Ritchie Carroll
//       Generated original version of source code.
//
//*****************************************************************************************************@
@using GSF.Web
@using System.Net.Http
@using openECAClient.Model
@using RazorEngine.Templating
@inherits TemplateBase<AppModel>

@section Scripts {
    <script src="Scripts/io-mappings-scripts.js"> </script>
}
@{
    Layout = "Layout.cshtml";
    HttpRequestMessage request = ViewBag.Request;
    string baseURL = request.RequestUri.AbsolutePath;
    if (baseURL.Contains("Base"))
    {
        ViewBag.Title = "Manage Data Mappings Base of Operations";
    }
}

@section StyleSheets {
    <style>
        .row {
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .list-group-item{
            display: inline-table;
            width: 100%;
        }

    </style>
}

<div ng-app="UserDefinedMappings">
    <div ng-controller="MappingsCtrl">
        @*<input type="checkbox" ng-model="iocheckbox" ng-change="iocheckboxChange()"/>*@

        @*<p hidden="hidden">Viewing: {{ioString}} Mappings</p>*@
        <p>File location: {{filelocation}}</p>

        <div class="input-group">
            <input class="form-control" ng-model="searchText" placeholder="Search" type="search" ng-change="search()" /> <span class="input-group-addon">
                <span class="glyphicon glyphicon-search"></span>
            </span>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th class="EmpId" style="width: 10%">
                        <a href="#" ng-click="sort('Type')">
                            Type
                            <span class="{{Header[0]}}"></span>
                        </a>

                    </th>
                    <th class="name" style="width: 25%">
                        <a ng-click="sort('Identifier')" href="#">
                            Identifier
                            <span class="{{Header[1]}}"></span>
                        </a>
                    </th>
                    <th class="Email" style="width: 60%">
                        <a ng-click="sort('Mappings')" href="#">
                            Mappings
                            <span class="{{Header[2]}}"></span>
                        </a>
                    </th>
                    <th class="pull-right" style="width: 6%">
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="item in pagedMappings[currentPage - 1]">
                    <td>{{item.Type.Category + ' ' + item.Type.Identifier}}</td>
                    <td>{{item.Identifier}}</td>
                    <td><a href="#" data-toggle="tooltip" title={{getExpressions(item)}}>{{getExpressions(item).truncate(90)}}</a></td>
                    <td><button id="updatebtn{{$index}}" class="btn btn-link" style="padding: 0;" ng-click="updateMapping(item)"><span class="glyphicon glyphicon-pencil"></span></button><button id="btn{{$index}}" class="btn btn-link" style="padding: 5px;" ng-click="removeMapping(item)"><span class="glyphicon glyphicon-remove-sign"></span></button></td>
                </tr>
            </tbody>
        </table>

        <div class="pull-left">
            <div class="btn-group btn-group-sm">
                <button type="button" class="btn btn-default" ng-disabled="currentPage == 1" ng-click="firstPage()"><span class="glyphicon glyphicon-backward"></span></button>
                <button type="button" class="btn btn-default" ng-disabled="currentPage == 1" ng-click="minusPage()"><span class="glyphicon glyphicon-triangle-left"></span></button>
            </div>
            <input type="number" class="content input-sm" style="padding: 0 0 0 5px; width: 55px" ng-model="currentPage">
            <em class="validationMessage small" style="display: none;"></em>
            &nbsp;of&nbsp;
            <span ng-bind="pageCount"></span>
            &nbsp;
            <div class="btn-group btn-group-sm">
                <button type="button" class="btn btn-default" ng-disabled="currentPage == pageCount" ng-click="plusPage()"><span class="glyphicon glyphicon-triangle-right"></span></button>
                <button type="button" class="btn btn-default" ng-disabled="currentPage == pageCount" ng-click="lastPage()"><span class="glyphicon glyphicon-forward"></span></button>
            </div>
        </div>

        <!--<button type="button" class="btn btn-primary pull-right" data-toggle="modal" data-target="#filterDialog" hidden="hidden">Filter Dialog</button>-->
        <button type="button" class="btn btn-primary pull-right" data-toggle="modal" ng-click="addMapping()" ng-disabled="!metaDataRecieved" data-target="#mappingDialog">Add Mapping</button>

        <div class="pull-right">
            Rows:
            <div class="btn-group">
                <button ng-class="{active: pageSize == 10}" class="btn btn-default" ng-click="setPageSize(10)">10</button>
                <button ng-class="{active: pageSize == 25}" class="btn btn-default" ng-click="setPageSize(25)">25</button>
                <button ng-class="{active: pageSize == 50}" class="btn btn-default" ng-click="setPageSize(50)">50</button>
                <button ng-class="{active: pageSize == 100}" class="btn btn-default" ng-click="setPageSize(100)">100</button>
            </div>
        </div>

        <!-- Modals -->
        <div id="mappingDialog" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Add/Edit Mapping</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <label for="types">Type:</label>
                                <select class="form-control" id="types" ng-model="mapping.TypeIndex" ng-change="updateTypeMappings()">
                                    <option ng-repeat="x in type" value="{{$index}}">{{ x.Category + ' ' + x.Identifier}}</option>
                                </select>

                            </div>
                            <div class="col-md-6">
                                <label for="identifier">Mapping Identifier:</label>
                                <input class="form-control" type="text" id="identifier" ng-model="mapping.Identifier">
                            </div>

                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <ul class="list-group" id="fields">
                                    <!-- IS NOT AN ARRAY AND IS NOT USER DEFINED -->
                                    <li class="list-group-item" ng-repeat="x in mapping.FieldMappings" ng-if="!x.Field.Type.IsArray && !x.Field.Type.IsUserDefined">
                                        <div class="col-md-6">
                                            <label>{{x.Field.Type.Category + ' ' + x.Field.Type.Identifier + ' ' + x.Field.Identifier }}:</label>
                                            <div class="input-group">
                                                <input id="input{{x.Field.Identifier}}" class="form-control" type="text" ng-model="x.Expression">
                                                <span class="input-group-btn">
                                                    <button type="button" class="btn btn-default btn-select-measurements" ng-click="addOneSignal(x)" ng-disabled="!metaDataRecieved">Select</button>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                <a href="#" ng-click="openTimeWindow(x)">Edit Relative Time</a>
                                            </label>
                                            <input class="form-control" type="text" ng-model="x.TimeWindowExpression" />
                                        </div>
                                    </li>

                                    <!-- IS NOT AN ARRAY AND IS USER DEFINED -->
                                    <li class="list-group-item" style="height: 80px" ng-repeat="x in mapping.FieldMappings" ng-if="!x.Field.Type.IsArray && x.Field.Type.IsUserDefined">
                                        <div class="col-md-6">
                                            <label>{{x.Field.Type.Category + ' ' + x.Field.Type.Identifier + ' ' + x.Field.Identifier }}:</label>
                                            <select class="form-control" ng-model="x.Expression">
                                                <option ng-repeat="m in rawData" ng-if="x.Field.Type.Category == m.Type.Category && x.Field.Type.Identifier == m.Type.Identifier" value="{{m.Identifier}}">{{m.Identifier}}</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                <a href="#" ng-click="openTimeWindow(x)">Edit Relative Time</a>
                                            </label>
                                            <input class="form-control" type="text" ng-model="x.TimeWindowExpression" />
                                        </div>
                                    </li>

                                    <!-- IS AN ARRAY AND UNDERLYING TYPE IS USER DEFINED -->
                                    <li class="list-group-item" style="height: 80px" ng-repeat="x in mapping.FieldMappings" ng-if="x.Field.Type.IsArray && x.Field.Type.UnderlyingType.IsUserDefined">
                                        <div class="col-md-6">
                                            <label>{{x.Field.Type.Category + ' ' + x.Field.Type.Identifier + ' ' + x.Field.Identifier }}:</label>
                                            <div class="input-group">
                                                <input class="form-control" ng-model="x.Expression">
                                                <div class="input-group-btn">
                                                    <select class="form-control multiselect" multiple="multiple" ng-model="multiselectData" ng-init="initializeMultiselect(x, this)" ng-change="addToExpression(x, this)">
                                                        <option ng-repeat="m in rawData" ng-if="x.Field.Type.UnderlyingType.Category == m.Type.Category && x.Field.Type.UnderlyingType.Identifier == m.Type.Identifier" value="{{m.Identifier}}">{{m.Identifier}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6" ng-if="loadSelectBox()">
                                            <label>
                                                <a href="#" data-toggle="modal" ng-click="openTimeWindow2(x)" ng-show="!showTimeWindow(x)">Edit Time Window</a>
                                                <a href="#" data-toggle="modal" ng-click="openTimeWindow(x)" ng-show="showTimeWindow(x)">Edit Relative Time</a>
                                            </label>
                                            <input class="form-control" type="text" ng-model="x.TimeWindowExpression" />
                                        </div>
                                    </li>

                                    <!-- IS AN ARRAY AND UNDERLYING TYPE IS NOT USER DEFINED -->
                                    <li class="list-group-item" style="height: 80px" ng-repeat="x in mapping.FieldMappings" ng-if="x.Field.Type.IsArray && !x.Field.Type.UnderlyingType.IsUserDefined">
                                        <div class="col-md-6">
                                            <label>{{x.Field.Type.Category + ' ' + x.Field.Type.Identifier + ' ' + x.Field.Identifier }}:</label>
                                            <div class="input-group">
                                                <input class="form-control" type="text" ng-model="x.Expression" />
                                                <span class="input-group-btn">
                                                    <button type="button" class="btn btn-default btn-select-measurements" ng-click="addMultipleSignals(x)" ng-disabled="!metaDataRecieved">Select</button>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label>
                                                <a href="#" data-toggle="modal" ng-click="openTimeWindow(x)">Edit Relative Time</a>
                                            </label>
                                            <input class="form-control" type="text" ng-model="x.TimeWindowExpression" />
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="editSignalsBtn" class="btn btn-primary" ng-if="showAddSignals() && signalsAdded" ng-click="openSignalDialog()" ng-disabled="!metaDataRecieved || !saveBtnEnabler()">Edit Signals</button>
                        <button type="button" id="addSignalsBtn" class="btn btn-primary" ng-if="showAddSignals() && !signalsAdded" ng-click="openSignalDialog()" ng-disabled="!metaDataRecieved || !saveBtnEnabler()">Add Signals</button>
                        <button type="button" id="updateBtn" class="btn btn-primary" ng-click="editMapping()" ng-disabled="!metaDataRecieved || !saveBtnEnabler()" hub-dependent>Update</button>
                        <button type="button" id="saveBtn" class="btn btn-primary" ng-click="saveMapping()" ng-disabled="!metaDataRecieved || !saveBtnEnabler()">Save</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    </div>
                </div>

            </div>
        </div>

        <div id="signalDialog" class="modal modal-wide fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Add Signals</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row" style="padding-left: 5px; padding-right: 5px">
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat="x in mapping.Type.Fields">
                                    <div class="row">
                                        <h4>Signal {{$index + 1}}</h4>
                                        <label>Project Name:</label>
                                        <input id="proj{{x.Identifier}}" class="form-control" type="text" value="@Model.Global.ProjectName.JavaScriptEncode()" />
                                        <label>Instance Name:</label>
                                        <input id="inst{{x.Identifier}}" class="form-control" type="text" value="{{mapping.Identifier}}" />
                                        <label>Point Tag:</label>
                                        <input id="point{{x.Identifier}}" class="form-control" value="@Model.Global.ProjectName.JavaScriptEncode()_{{mapping.Identifier + ':' + x.Identifier}}" />
                                        <label>Signal Type:</label>
                                        <select id="type{{x.Identifier}}" class="form-control">
                                            <option value="IPHM">IPHM</option>
                                            <option value="IPHA">IPHA</option>
                                            <option value="VPHM">VPHM</option>
                                            <option value="VPHA">VPHA</option>
                                            <option value="FREQ">FREQ</option>
                                            <option value="DFDT">DFDT</option>
                                            <option value="ALOG">ALOG</option>
                                            <option value="DIGI">DIGI</option>
                                            <option value="CALC" selected="selected">CALC</option>
                                        </select>
                                        <label>Description:</label>
                                        <textarea id="desc{{x.Identifier}}" class="form-control">Autogenerated using add signal button for the {{mapping.Identifier}} mapping and the {{x.Identifier}} field.</textarea>
                                    </div>
                                    <div> <!--Hide in production-->
                                        <input id="signalID{{x.Identifier}}" class="form-control" value="00000000-0000-0000-0000-000000000000" type="text" />
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button ng-click="addNewSignals()" type="button" class="btn btn-primary" hub-dependent>Save</button>
                        <button type="button" class="btn btn-default" ng-click="cancelSignalDialog()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="timeWindowDialog" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true">
            <div class="modal-vertical-align-container">
                <div class="modal-dialog modal-lg  modal-vertical-align-center">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal">×</a>
                            <h4>{{timeWindowField.Identifier}} Sliding Window Mapping Editor</h4>
                        </div>
                        <div class="modal-body" style="height: 300px; overflow-y: auto">
                            <label>Relative Time:</label>
                            <select class="form-control selectAfterCancel" ng-model="relativeTimeSelect">
                                <option value="99">None</option>
                                <option value="0"> &lt;Number&gt; &lt;TimeUnit&gt; ago </option>
                                <option value="1"> &lt;Number&gt; &lt;TimeUnit&gt; ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <option value="2"> &lt;Number&gt; points ago</option>
                                <option value="3"> &lt;Number&gt; points ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                            </select>
                            <hr />
                            <div id="secondMaprt" class="deleteAfterCancel">
                                <div ng-if="relativeTimeSelect==99">

                                </div>

                                <div ng-if="relativeTimeSelect==0">
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number" />
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow1">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>ago</span>
                                </div>

                                <div ng-if="relativeTimeSelect==1">
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number" />
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow1">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>ago</span>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number2" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow2">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>

                                <div ng-if="relativeTimeSelect==2">
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number" />
                                    <span>points</span>
                                    <span>ago</span>
                                </div>

                                <div ng-if="relativeTimeSelect==3">
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number" />
                                    <span>points</span>
                                    <span>ago</span>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number2" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow1">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>
                            </div>
                            <hr />
                            <label>Mapping Text:</label>
                            <textarea class="form-control clearAfterCancel" ng-model="timeWindowText"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-dismiss="modal" id="timeWindowSave">Save</button>
                            <button class="btn btn-default" data-dismiss="modal" ng-click="clearFields()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="timeWindowDialog2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true">
            <div class="modal-vertical-align-container">
                <div class="modal-dialog modal-lg  modal-vertical-align-center">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal">×</a>
                            <h4>Sliding Window Mapping Editor</h4>
                        </div>
                        <div class="modal-body" style="height: 300px; overflow-y: auto">
                            <label>Time Window:</label>'
                            <select class="form-control selectAfterCancel" ng-model="relativeTimeSelect">
                                <option value="99">None</option>
                                <option value="0">last &lt;Number&gt; &lt;TimeUnit&gt; </option>
                                <option value="1">last &lt;Number&gt; &lt;TimeUnit&gt; &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <option value="2">last &lt;Number&gt; points </option>';
                                <option value="3">last &lt;Number&gt; points &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <option value="4">from &lt;Number&gt; &lt;TimeUnit&gt; ago for &lt;Number&gt; &lt;TimeUnit&gt;</option>
                                <!--<option value="5">from &lt;Number&gt; &lt;TimeUnit&gt; ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; &lt;TimeUnit&gt; </option>-->
                                <option value="6">from &lt;Number&gt; &lt;TimeUnit&gt; ago for &lt;Number&gt; &lt;TimeUnit&gt; &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <!--<option value="7">from &lt;Number&gt; &lt;TimeUnit&gt; ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; &lt;TimeUnit&gt; &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>-->
                                <option value="8">from &lt;Number&gt; points ago for &lt;Number&gt; &lt;TimeUnit&gt;</option>
                                <!--<option value="9">from &lt;Number&gt; points ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; &lt;TimeUnit&gt; </option>-->
                                <option value="10">from &lt;Number&gt; points ago for &lt;Number&gt; &lt;TimeUnit&gt; &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <!--<option value="11">from &lt;Number&gt; points ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; &lt;TimeUnit&gt; &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>-->
                                <option value="12">from &lt;Number&gt; &lt;TimeUnit&gt; ago for &lt;Number&gt; points</option>
                                <!--<option value="13">from &lt;Number&gt; &lt;TimeUnit&gt; ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; points </option>-->
                                <option value="14">from &lt;Number&gt; &lt;TimeUnit&gt; ago for &lt;Number&gt; points &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <!--<option value="15">from &lt;Number&gt; &lt;TimeUnit&gt; ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; points &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>-->
                                <option value="16">from &lt;Number&gt; points ago for &lt;Number&gt; points</option>
                                <!--<option value="17">from &lt;Number&gt; points ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; points </option>-->
                                <option value="18">from &lt;Number&gt; points ago for &lt;Number&gt; points &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>
                                <!--<option value="19">from &lt;Number&gt; points ago &#64; &lt;Number&gt; per &lt;TimeUnit&gt; for &lt;Number&gt; points &#64; &lt;Number&gt; per &lt;TimeUnit&gt;</option>-->
                            </select>
                            <hr />
                            <div id="secondMaptw" class="deleteAfterCancel">
                                <div ng-if="relativeTimeSelect==99">

                                </div>

                                <div ng-if="relativeTimeSelect==0">
                                    <span>last</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number" />
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>

                                <div ng-if="relativeTimeSelect==1">
                                    <span>last</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number1" />
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow1">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText()" ng-model="number2" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow2">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>

                                <div ng-if="relativeTimeSelect==2">
                                    <span>last</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number" />
                                    <span>points</span>
                                </div>

                                <div ng-if="relativeTimeSelect==3">
                                    <span>last</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number1" />
                                    <span>points</span>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number2" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow2">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>

                                <div ng-if="relativeTimeSelect==4">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number1" />
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow1">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number2" />
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow2">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>

                                <div ng-if="relativeTimeSelect==6">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number3" />
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow3">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number4" />
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow4">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number5" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow5">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>

                                </div>

                                <div ng-if="relativeTimeSelect==8">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number1" />
                                    <span>points</span>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number2" />
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow2">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                </div>

                                <div ng-if="relativeTimeSelect==10">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number3" />
                                    <span>points</span>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number4" />
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow4">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number5" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow5">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>

                                </div>

                                <div ng-if="relativeTimeSelect==12">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number1" />
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow1">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number2" />
                                    <span>points</span>
                                </div>

                                <div ng-if="relativeTimeSelect==14">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number3" />
                                    <select ng-change="updateTimeWindowText()" ng-model="timewindow3">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number4" />
                                    <span>points</span>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number5" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow5">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>

                                </div>

                                <div ng-if="relativeTimeSelect==16">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number1" />
                                    <span>points</span>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number2" />
                                    <span>points</span>
                                </div>

                                <div ng-if="relativeTimeSelect==18">
                                    <span>from</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number3" />
                                    <span>points</span>
                                    <span>ago</span>
                                    <span>for</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number4" />
                                    <span>points</span>
                                    <span>@@</span>
                                    <input type="number" ng-change="updateTimeWindowText2()" ng-model="number5" />
                                    <span>per</span>
                                    <select ng-change="updateTimeWindowText2()" ng-model="timewindow5">
                                        <option>microseconds</option>
                                        <option>milliseconds</option>
                                        <option>seconds</option>
                                        <option>minutes</option>
                                        <option>hours</option>
                                        <option>days</option>
                                    </select>

                                </div>

                            </div>

                            <hr />
                            <label>Mapping Text:</label>
                            <textarea class="form-control clearAfterCancel" ng-model="timeWindowText"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" data-dismiss="modal" id="timeWindowSave2">Save</button>
                            <span class="btn btn-default" data-dismiss="modal" ng-click="clearFields()">Cancel</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="deviceList" class="modal modal-wide fade" tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true">
            <div class="modal-vertical-align-container">
                <div class="modal-dialog modal-vertical-align-center">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal">×</a><h4>Signal Selection</h4>
                        </div>
                        <div class="modal-body" style="height: 80%; overflow-y: auto">
                            <div id="devicelistOuter" class="panel-group">
                                <div id="devicelistinner" class="panel panel-default" ng-repeat="x in deviceList">
                                    <div class="panel-heading">
                                        <a class="btn btn-link btn-sm" style="font-size: x-small;" data-toggle="collapse" data-parent="#devicelistOuter" href="#dd{{fixAcronyms(x.ParentAcronym)}}">{{x.ParentAcronym}}</a>
                                    </div>
                                    <div id="dd{{fixAcronyms(x.ParentAcronym)}}" class="panel-collapse collapse" ng-class='{in:$first}'>
                                        <div class="panel-body" id="innerPanel{{fixAcronyms(x.ParentAcronym)}}">
                                            <div class="panel panel-default" ng-repeat="y in x.Devices">
                                                <div class="panel-heading">
                                                    <a class="btn btn-link btn-sm panel-title" style="font-size: x-small;" title="{{y.Acronym}}" data-parent="#innerPanel{{fixAcronyms(x.ParentAcronym)}}" data-toggle="collapse" href="#dd{{fixAcronyms(y.Acronym)}}">{{y.Acronym}}</a>
                                                </div>
                                                <div id="dd{{fixAcronyms(y.Acronym)}}" class="collapse panel-collapse" ng-class='{in:$first}'>
                                                    <table class="table" style="width: 100%; font-size: x-small;">
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Stream</th>
                                                            <th>Signal</th>
                                                            <th>Description</th>
                                                        </tr>
                                                        <tr ng-repeat="z in y.Measurements">
                                                            <td nowrap><label class="checkbox-inline"><input type="checkbox" id="cb{{z.ID}}" value="{{z.ID}}">{{z.ID}}</label></td>
                                                            <td>{{z.SignalReference}}</td>
                                                            <td>{{z.SignalAcronym}}</td>
                                                            <td>{{z.Description}}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary" id="addSignalsButton">Add</button>
                            <button class="btn btn-default" ng-click="cancelDeviceList()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="filterDialog" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4>Manage Filter Expression</h4>
                    </div>
                    <div class="modal-body">
                        <input class="form-control" type="text" ng-model="filterExpression" />
                    </div>
                </div>
            </div>
        </div>

        <div id="errors">
            <div id="modal-errors" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true">
                <div class="modal-vertical-align-container">
                    <div class="modal-dialog  modal-vertical-align-center">
                        <div class="modal-content">
                            <div class="modal-header">
                                <a class="close" data-dismiss="modal">×</a>
                                <h4>Errors</h4>
                            </div>
                            <div class="modal-body" style="max-height: 500px; overflow-y: auto"></div>
                            <div class="modal-footer">
                                <input type="button" id="save-errors" class="btn" value="Save" />
                                <input type="button" class="btn" value="Close" data-dismiss="modal" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Do not delete, used to append dynamic modals to-->
        <div id="modals"></div>
    </div>
</div>